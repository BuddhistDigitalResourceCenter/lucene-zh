# Lucene Analyzers for Buddhist Chinese

## Indexing Pipeline:

```
TC ⟾ normalized TC ⟾ SC ⟾ normalized SC ⟾ normalized PY_full ⟾ normalized PY_lazy
```

`normalized TC/SC`: any combination of the following treatments: synonyms, alternatives and stopwords.

`normalized PY`: PY is lower-cased and split in syllables (to match the general policy of indexing individual ideograms).

The pipeline may start at any step and may end at any step.
For example, words in lazy pinyin only need to be normalized.

Including the diacritics in a PY index allows to reduce the homophones, thus reducing the noise in the results.

In the Unihan database, 88884 codepoints have an entry(both full ideograms and parts of surrogate pairs).
82829 entries have no information about being TC nor SC, 3037 are specifically TC, 3007 are specifically SC and 11 have information about both TC and SC.

There are 1655 possible syllables in full PY, 469 in lazy PY (syllable size spans from 1 to 6 chars).

## Constructors

```
ChineseAnalyzer(String indexEncoding,String inputEncoding,boolean stopwords, int variants) 
    indexEncoding- "TC", "SC", "PY_full" or "PY_lazy"
    inputEncoding- "TC", "SC", "PY_full" or "PY_lazy"
    stopWords    - true to filter stopwords, false otherwise
    variants     - 0: no variant; 1: synonyms; 2: alternatives; 3: both
```

```
ChineseAnalyzer(String profile)
    profile == "exact"- ChineseAnalyzer("TC", "TC", false, 0)
    (...)
```

## Components

### Tokenizer

StandardTokenizer is used(it incorporated the historical Chinese Tokenizer). 
Tokens produced are ideograms.

### Filters

#### TC2SCFilter (TokenFilter)

Leverages Unihan data to replace token content with the SC equivalent.

#### PinyinFilter (TokenFilter)

Replaces the token content(TC and SC) with the pinyin transcription. 

#### LazyPinyinFilter (TokenFilter)

Removes tone marks in Pinyin.

#### LowerCaseFilter (MappingCharFilter)

Used as a pre-processing step for PY indexing

#### PySylabifierFilter

Produces syllables from pinyin-encoded text (either lazy or normal)

TODO: determine the best strategy to do it

#### ZhSynonymsFilter (MappingCharFilter)

Leverages Unihan's kSemanticVariant field to index the same variant for all synonyms.

#### ZhAlternatesFilter (MappingCharFilter)

Leverages Unihan's kZVariant field to index the same variant for stylistic variants of the same ideogram.

## Resources
`src/main/resources` is the output of lucene-zh-data, generated by `make`.

`src/main/resources/zh-stopwords.txt` is [this stop-list](https://github.com/stopwords-iso/stopwords-zh/blob/master/stopwords-zh.txt) 

## Licence
The code is Copyright 2018 Buddhist Digital Resource Center, and is provided under [Apache License 2.0](LICENSE).

Files in `src/main/resources` remain under [Unicode License](http://unicode.org/copyright.html), except `zh-stopwords.txt`, under [MIT Licence](https://opensource.org/licenses/MIT).